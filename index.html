<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>청소당번 랜덤 추첨기</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-gradient-to-br from-blue-900 to-indigo-900 min-h-screen flex items-center justify-center p-4">
  <div class="bg-white/10 backdrop-blur-lg rounded-2xl shadow-2xl max-w-lg w-full p-6 border border-white/20">
    <h1 class="text-2xl font-bold text-white mb-2">학급 청소당번 랜덤 추첨</h1>
    <p class="text-blue-200 mb-4">1번부터 30번 사이에서 <strong>5명</strong>을 중복 없이 랜덤 추첨합니다.</p>

    <div class="flex gap-2 mb-4">
      <button id="drawBtn" class="btn btn-primary flex-1">🎲 추첨하기</button>
      <button id="resetBtn" class="btn btn-outline-light">↺ 초기화</button>
    </div>

    <div id="results" class="flex flex-wrap gap-2 justify-center p-4 bg-black/30 rounded-lg border border-white/10 min-h-[80px] text-white"></div>

    <div class="flex items-center gap-2 mt-4">
      <button id="copyBtn" class="btn btn-outline-info">📋 결과 복사</button>
      <span id="copyMsg" class="text-sm text-blue-200"></span>
    </div>
  </div>

  <script>
    const MIN = 1;
    const MAX = 30;
    const COUNT = 5;

    const drawBtn = document.getElementById('drawBtn');
    const resetBtn = document.getElementById('resetBtn');
    const copyBtn  = document.getElementById('copyBtn');
    const results  = document.getElementById('results');
    const copyMsg  = document.getElementById('copyMsg');

    function validateConfig(min, max, count){
      if(min > max) return 'MIN은 MAX보다 작거나 같아야 합니다.';
      if(count < 1) return 'COUNT는 1 이상이어야 합니다.';
      if(count > (max - min + 1)) return 'COUNT가 범위보다 큽니다.';
      return null;
    }

    function secureShuffle(array){
      const a = array.slice();
      for(let i = a.length - 1; i > 0; i--){
        const r = crypto.getRandomValues(new Uint32Array(1))[0] / 2**32;
        const j = Math.floor(r * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function pickUnique(min, max, count){
      const range = Array.from({length: max - min + 1}, (_,i) => i + min);
      const shuffled = secureShuffle(range);
      return shuffled.slice(0, count).sort((a,b) => a - b);
    }

    function renderChips(nums){
      results.innerHTML = '';
      nums.forEach(n => {
        const el = document.createElement('div');
        el.className = 'bg-gradient-to-br from-blue-400 to-blue-600 text-white font-bold rounded-full w-14 h-14 flex items-center justify-center shadow-lg';
        el.textContent = n;
        results.appendChild(el);
      });
    }

    function draw(){
      const err = validateConfig(MIN, MAX, COUNT);
      if(err){
        Swal.fire('설정 오류', err, 'error');
        return;
      }
      const nums = pickUnique(MIN, MAX, COUNT);
      renderChips(nums);
      results.setAttribute('data-nums', nums.join(', '));
      Swal.fire('추첨 완료 🎉', `당첨 번호: ${nums.join(', ')}`, 'success');
    }

    function reset(){
      results.innerHTML = '';
      results.removeAttribute('data-nums');
      copyMsg.textContent = '';
    }

    async function copyResult(){
      const text = results.getAttribute('data-nums');
      if(!text){
        Swal.fire('알림', '복사할 결과가 없습니다.', 'info');
        return;
      }
      try{
        await navigator.clipboard.writeText(text);
        copyMsg.textContent = `복사됨: [ ${text} ]`;
        Swal.fire('복사 완료', `${text}`, 'success');
      }catch(e){
        Swal.fire('실패', '복사 권한을 허용해주세요.', 'error');
      }
    }

    drawBtn.addEventListener('click', draw);
    resetBtn.addEventListener('click', reset);
    copyBtn.addEventListener('click', copyResult);

    results.innerHTML = '<span class="text-blue-200">버튼을 눌러 추첨을 시작하세요 🎲</span>';
  </script>
</body>
</html>
